---
title: "Omni API"
output:
  html_document:
    toc: true
    toc_float: true
    theme: paper
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.path = 'figures/',
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.width = 10, fig.height = 3,
  cache = FALSE)
```

---

```{r}
source("functions_epic.R")
```

# Get Devices

```{r}
url <- "https://developer-apis.awair.is/v1/orgs/{{2059}}/devices?filter=location_id={{epic_homes}}&page_size={{page_size}}&page_token={{page_token}}"
```



```{r}
url <- "http://developer-apis.awair.is/v1/users/self/devices"

device_tbl <- as_tibble(content(GET(url, add_headers(Authorization = paste("x-api-key", tkn, sep = " "))))) %>%
  unnest_wider(devices) %>%
  rename_all(tolower)
```

---

# Homes
