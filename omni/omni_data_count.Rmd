---
title: "Count amount of Omni Data"
output:
  html_document:
    toc: true
    toc_float: true
    theme: paper
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.path = 'figures/',
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.width = 10, fig.height = 3,
  cache = FALSE)
```

---

```{r}
library(dplyr)
library(purrr)
library(tidyr)
library(openair)
library(ggplot2)
library(readr)
library(googlesheets4)
library(lubridate)
library(data.table)
library(kableExtra)
```


```{r define_variables}
#define the homes that will be used later in analysis
homes_no5 <- c(
  map(c(1:4,6:9), function(x) paste0('00', x)),
  map(c(10:16), function(x) paste0('0', x))
  )%>% unlist()


##For plot labeling pruposes
xsmall <- 6
small <- 15
medium <- 20
large <- 26

# color blind pallette
# check http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/#a-colorblind-friendly-palette
cbbPalette <- c('black' = "#000000",
                'light_orange' = "#E69F00",
                'light_blue' = "#56B4E9",
                'green' = "#009E73",
                'yellow' = "#F0E442",
                'dark_blue' = "#0072B2",
                'dark_orange' = "#D55E00",
                'purple' = "#CC79A7"
                )
# define colors for room-comparisons
location_colors <- c(cbbPalette['green'],
                   cbbPalette['purple'],
                   cbbPalette['light_orange'],
                   cbbPalette['dark_blue'],
                   cbbPalette['dark_orange']
                   )%>% unname()

location_breaks <- c('living', 'bedroom', 'kitchen', 'garage', 'outdoor')

location_labels <- c('Living Room', 'Bedroom', 'Kitchen', 'Garage', 'Outdoor')

```

# read in data
```{r}
data <- read_rds('./csv_created/omni_hourly_calibrated.rds')

```

# only use data up to June 2021 and indoor data
```{r censor_date}
data <- data %>% filter(datehour<ymd_hms('2021-06-01 00:00:00'))


```


# BY ALL SENSORS 


# count hours of data and percentage of data missing from within each sensor in its sampling period
* use temperature as a count, as temp was the only indicator for which values were cleaned (high readings from malfunctions in cold weather)

```{r, eval = FALSE}

sensor_avail <-
  data %>%
    group_by(home, location) %>%
  summarise(
    start_date = min(datehour),
    end_date = max(datehour),
    hours = length(seq(from=start_date, to=end_date, by='hour')),
    hours_avail = sum(!is.na(temp))-1, #count amount of hour readings available
    pct_avail = hours_avail/hours,
    .groups = 'drop'
  )

write_csv(sensor_avail, './csv_created/omni_sensor_count/sensor_avail.csv')

write_csv(sensor_avail, paste0('./csv_created/omni_sensor_count/sensor_avail_',
Sys.Date(),'.csv'))

```

# BY HOMES

# count hours of data and percentage of data missing from within each home in its sampling period
* only use indoor sensors
* use temperature as a count, as temp was the only indicator for which values were cleaned (high readings from malfunctions in cold weather)
* assume data is not missing if at least one sensor inside home is operating

```{r,  eval = FALSE}
  

home_avail <-
data %>%
  filter(location %in% c('bedroom', 'kitchen', 'living')) %>%
  filter(!is.na(temp)) %>%
    group_by(home) %>%
  summarise(
        room_hours = n(), #count amount of room-hours available for each home
    start_date = min(datehour),
    end_date = max(datehour),
    hours = length(seq(from=start_date, to=end_date, by='hour')),
    hours_avail = length(unique(datehour)), #count amount of hours for which at least one indoor sensor has a reading
    pct_avail = hours_avail/hours,
    .groups = 'drop'
  )

write_csv(home_avail, './csv_created/omni_sensor_count/home_avail.csv')

write_csv(home_avail, paste0('./csv_created/omni_sensor_count/home_avail_',
Sys.Date(),'.csv'))
```





